import matplotlib.pyplot as plt
import datetime as dt


trialSpectrum = [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 8, 8, 8, 10, 12, 12, 12, 12, 12, 12, 12, 11, 11, 18, 18, 18, 18, 18, 20, 20, 20, 20, 17, 17, 17, 14, 14, 14, 18, 18, 19, 19, 19, 19, 18, 18, 18, 28, 28, 28, 34, 34, 34, 26, 26, 26, 26, 40, 40, 40, 33, 33, 42, 42, 46, 46, 53, 53, 55, 55, 55, 58, 58, 66, 66, 66, 66, 71, 71, 71, 71, 84, 90, 90, 90, 90, 76, 76, 76, 75, 75, 75, 75, 75, 75, 75, 75, 75, 75, 75, 73, 85, 66, 71, 71, 71, 65, 65, 65, 68, 68, 60, 60, 58, 58, 66, 66, 69, 69, 69, 68, 68, 67, 67, 67, 75, 75, 75, 63, 63, 59, 59, 58, 58, 58, 55, 55, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 63, 63, 63, 55, 57, 51, 47, 49, 50, 50, 42, 42, 45, 45, 44, 44, 44, 48, 48, 48, 37, 37, 37, 36, 36, 36, 41, 41, 41, 41, 44, 35, 36, 36, 36, 36, 36, 36, 36, 33, 33, 33, 37, 37, 40, 40, 40, 40, 40, 40, 40, 39, 39, 36, 36, 40, 40, 40, 40, 40, 32, 32, 32, 32, 25, 25, 25, 26, 26, 26, 35, 35, 35, 35, 35, 34, 33, 33, 28, 28, 28, 28, 30, 30, 30, 32, 32, 32, 27, 27, 37, 37, 37, 37, 21, 21, 21, 23, 23, 23, 23, 32, 32, 26, 26, 26, 26, 24, 24, 25, 25, 18, 18, 18, 18, 16, 16, 17, 17, 17, 20, 20, 19, 19, 21, 21, 21, 21, 21, 15, 15, 18, 18, 18, 18, 18, 18, 18, 17, 17, 17, 19, 19, 17, 16, 16, 16, 20, 20, 20, 16, 16, 16, 21, 21, 21, 17, 10, 10, 14, 14, 14, 16, 16, 16, 16, 15, 15, 15, 15, 11, 11, 11, 11, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 13, 13, 13, 8, 8, 14, 14, 17, 17, 17, 17, 17, 9, 9, 11, 11, 13, 13, 16, 16, 16, 16, 16, 9, 9, 10, 10, 10, 9, 9, 6, 6, 10, 10, 10, 7, 7, 11, 11, 11, 12, 12, 12, 9, 9, 9, 9, 9, 12, 12, 10, 10, 10, 7, 7, 8, 8, 8, 8, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 9, 9, 9, 9, 9, 7, 7, 7, 6, 6, 6, 6, 9, 9, 9, 9, 8, 8, 8, 8, 4, 4, 4, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 5, 4, 4, 4, 4, 4, 4, 4, 7, 7, 8, 8, 6, 6, 6, 6, 6, 7, 7, 6, 6, 6, 6, 6, 6, 8, 8, 8, 7, 7, 7, 7, 3, 3, 3, 7, 7, 7, 1, 1, 1, 3, 3, 3, 4, 4, 7, 7, 7, 6, 6, 6, 6, 4, 4, 4, 7, 5, 5, 5, 5, 5, 6, 6, 6, 5, 5, 5, 5, 5, 4, 4, 4, 8, 8, 8, 8, 8, 8, 7, 7, 7, 4, 4, 4, 4, 8, 8, 8, 8, 8, 4, 4, 4, 4, 4, 4, 5, 5, 5, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 4, 4, 5, 5, 5, 3, 3, 4, 4, 6, 6, 6, 6, 4, 4, 4, 4, 4, 4, 4, 5, 5, 6, 6, 6, 6, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 6, 6, 6, 5, 5, 5, 6, 6, 6, 6, 4, 4, 6, 6, 6, 6, 6, 6, 4, 4, 5, 5, 5, 5, 5, 6, 6, 6, 3, 3, 3, 3, 5, 5, 5, 5, 5, 3, 3, 3, 3, 3, 3, 2, 2, 2, 4, 4, 4, 3, 3, 2, 2, 2, 4, 4, 3, 3, 3, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 2, 2, 2, 2, 4, 4, 4, 4, 2, 2, 1, 1, 3, 3, 3, 3, 3, 4, 4, 4, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1]
x = [-7.703226, -6.67742, -5.651614, -4.625808, -3.600002, -2.5741959999999997, -1.5483900000000004, -0.5225840000000002, 0.5032220000000001, 1.5290279999999994, 2.5548340000000005, 3.58064, 4.606445999999999, 5.632252, 6.658058, 7.683864000000001, 8.70967, 9.735475999999998, 10.761281999999998, 11.787088, 12.812894, 13.8387, 14.864505999999999, 15.890311999999998, 16.916117999999997, 17.941924, 18.96773, 19.993536, 21.019341999999998, 22.045147999999998, 23.070954, 24.09676, 25.122566, 26.148372000000002, 27.174177999999998, 28.199984, 29.225789999999996, 30.251596, 31.277402000000002, 32.303208, 33.329014, 34.35482, 35.380626, 36.406432, 37.432238, 38.458044, 39.48385, 40.509656, 41.535461999999995, 42.561268, 43.587074, 44.61288, 45.638686, 46.664491999999996, 47.690298, 48.716104, 49.74191, 50.767716, 51.793521999999996, 52.819328, 53.845134, 54.87094, 55.896746, 56.922551999999996, 57.948358, 58.974164, 59.999970000000005, 61.02577599999999, 62.051581999999996, 63.077388, 64.103194, 65.129, 66.154806, 67.180612, 68.206418, 69.232224, 70.25803, 71.283836, 72.309642, 73.335448, 74.361254, 75.38706, 76.412866, 77.438672, 78.464478, 79.490284, 80.51609, 81.541896, 82.567702, 83.593508, 84.619314, 85.64512, 86.670926, 87.696732, 88.722538, 89.748344, 90.77414999999999, 91.799956, 92.825762, 93.851568, 94.877374, 95.90317999999999, 96.928986, 97.954792, 98.980598, 100.006404, 101.03220999999999, 102.058016, 103.083822, 104.109628, 105.135434, 106.16123999999999, 107.187046, 108.212852, 109.238658, 110.264464, 111.29026999999999, 112.316076, 113.341882, 114.367688, 115.393494, 116.41929999999999, 117.445106, 118.470912, 119.496718, 120.522524, 121.54832999999999, 122.57413600000001, 123.599942, 124.62574799999999, 125.651554, 126.67736, 127.70316600000001, 128.728972, 129.754778, 130.780584, 131.80639, 132.832196, 133.858002, 134.883808, 135.909614, 136.93542, 137.961226, 138.987032, 140.012838, 141.038644, 142.06445, 143.090256, 144.116062, 145.141868, 146.167674, 147.19348, 148.219286, 149.245092, 150.270898, 151.296704, 152.32251, 153.348316, 154.374122, 155.399928, 156.425734, 157.45154, 158.477346, 159.503152, 160.528958, 161.554764, 162.58057, 163.606376, 164.632182, 165.657988, 166.683794, 167.7096, 168.735406, 169.761212, 170.787018, 171.812824, 172.83863, 173.864436, 174.890242, 175.916048, 176.941854, 177.96766, 178.993466, 180.019272, 181.045078, 182.070884, 183.09669, 184.122496, 185.148302, 186.174108, 187.199914, 188.22572, 189.25152599999998, 190.277332, 191.303138, 192.328944, 193.35475, 194.38055599999998, 195.406362, 196.432168, 197.457974, 198.48378, 199.50958599999998, 200.535392, 201.561198, 202.587004, 203.61281, 204.63861599999998, 205.664422, 206.690228, 207.716034, 208.74184, 209.76764599999998, 210.793452, 211.819258, 212.845064, 213.87087, 214.89667599999999, 215.922482, 216.948288, 217.974094, 218.9999, 220.02570599999999, 221.051512, 222.077318, 223.103124, 224.12893, 225.15473599999999, 226.180542, 227.206348, 228.232154, 229.25796, 230.28376599999999, 231.309572, 232.335378, 233.361184, 234.38699, 235.412796, 236.438602, 237.464408, 238.490214, 239.51602, 240.541826, 241.567632, 242.593438, 243.619244, 244.64505, 245.670856, 246.696662, 247.722468, 248.748274, 249.77408, 250.799886, 251.82569199999998, 252.85149800000002, 253.877304, 254.90311, 255.928916, 256.954722, 257.98052800000005, 259.00633400000004, 260.03214, 261.057946, 262.083752, 263.10955800000005, 264.13536400000004, 265.16117, 266.186976, 267.212782, 268.23858800000005, 269.26439400000004, 270.2902, 271.316006, 272.341812, 273.36761800000005, 274.39342400000004, 275.41923, 276.445036, 277.470842, 278.49664800000005, 279.52245400000004, 280.54826, 281.574066, 282.599872, 283.62567800000005, 284.65148400000004, 285.67729, 286.703096, 287.728902, 288.75470800000005, 289.78051400000004, 290.80632, 291.832126, 292.857932, 293.88373800000005, 294.90954400000004, 295.93535, 296.961156, 297.986962, 299.01276800000005, 300.03857400000004, 301.06438, 302.090186, 303.115992, 304.14179800000005, 305.16760400000004, 306.19341000000003, 307.219216, 308.245022, 309.27082800000005, 310.29663400000004, 311.32244000000003, 312.348246, 313.374052, 314.39985800000005, 315.42566400000004, 316.45147000000003, 317.477276, 318.503082, 319.52888800000005, 320.55469400000004, 321.58050000000003, 322.606306, 323.632112, 324.65791800000005, 325.68372400000004, 326.70953000000003, 327.735336, 328.761142, 329.78694800000005, 330.81275400000004, 331.83856000000003, 332.864366, 333.890172, 334.91597800000005, 335.94178400000004, 336.96759000000003, 337.993396, 339.019202, 340.04500800000005, 341.07081400000004, 342.09662000000003, 343.122426, 344.148232, 345.17403800000005, 346.19984400000004, 347.22565000000003, 348.251456, 349.277262, 350.30306800000005, 351.32887400000004, 352.35468000000003, 353.380486, 354.406292, 355.43209800000005, 356.45790400000004, 357.48371000000003, 358.509516, 359.535322, 360.56112800000005, 361.58693400000004, 362.61274000000003, 363.638546, 364.664352, 365.69015800000005, 366.71596400000004, 367.74177000000003, 368.767576, 369.793382, 370.81918800000005, 371.84499400000004, 372.87080000000003, 373.896606, 374.922412, 375.94821800000005, 376.97402400000004, 377.99983000000003, 379.025636, 380.051442, 381.07724800000005, 382.10305400000004, 383.12886000000003, 384.154666, 385.180472, 386.206278, 387.23208400000004, 388.25789000000003, 389.283696, 390.309502, 391.335308, 392.36111400000004, 393.38692000000003, 394.412726, 395.438532, 396.464338, 397.49014400000004, 398.51595000000003, 399.541756, 400.567562, 401.593368, 402.61917400000004, 403.64498000000003, 404.670786, 405.696592, 406.722398, 407.74820400000004, 408.77401000000003, 409.799816, 410.825622, 411.851428, 412.87723400000004, 413.90304000000003, 414.928846, 415.954652, 416.980458, 418.00626400000004, 419.03207000000003, 420.057876, 421.083682, 422.109488, 423.13529400000004, 424.16110000000003, 425.186906, 426.212712, 427.238518, 428.26432400000004, 429.29013000000003, 430.315936, 431.341742, 432.367548, 433.39335400000004, 434.41916000000003, 435.444966, 436.470772, 437.496578, 438.52238400000005, 439.54819000000003, 440.573996, 441.599802, 442.625608, 443.65141400000005, 444.67722000000003, 445.703026, 446.728832, 447.754638, 448.78044400000005, 449.80625000000003, 450.832056, 451.857862, 452.883668, 453.90947400000005, 454.93528000000003, 455.961086, 456.986892, 458.012698, 459.03850400000005, 460.06431000000003, 461.090116, 462.115922, 463.141728, 464.16753400000005, 465.19334000000003, 466.219146, 467.244952, 468.270758, 469.29656400000005, 470.32237000000003, 471.348176, 472.373982, 473.399788, 474.42559400000005, 475.45140000000004, 476.477206, 477.503012, 478.528818, 479.55462400000005, 480.58043000000004, 481.606236, 482.632042, 483.657848, 484.68365400000005, 485.70946000000004, 486.735266, 487.761072, 488.786878, 489.81268400000005, 490.83849000000004, 491.864296, 492.890102, 493.915908, 494.94171400000005, 495.96752000000004, 496.993326, 498.019132, 499.044938, 500.07074400000005, 501.09655000000004, 502.122356, 503.148162, 504.173968, 505.19977400000005, 506.22558000000004, 507.251386, 508.277192, 509.302998, 510.328804, 511.35461, 512.3804160000001, 513.4062220000001, 514.4320280000001, 515.457834, 516.48364, 517.509446, 518.535252, 519.561058, 520.586864, 521.61267, 522.638476, 523.6642820000001, 524.6900880000001, 525.715894, 526.7417, 527.767506, 528.793312, 529.819118, 530.844924, 531.87073, 532.896536, 533.9223420000001, 534.9481480000001, 535.973954, 536.99976, 538.025566, 539.051372, 540.077178, 541.102984, 542.12879, 543.154596, 544.1804020000001, 545.2062080000001, 546.232014, 547.25782, 548.283626, 549.309432, 550.335238, 551.361044, 552.38685, 553.412656, 554.4384620000001, 555.4642680000001, 556.490074, 557.51588, 558.541686, 559.567492, 560.593298, 561.619104, 562.64491, 563.670716, 564.6965220000001, 565.7223280000001, 566.748134, 567.77394, 568.799746, 569.825552, 570.851358, 571.877164, 572.90297, 573.928776, 574.9545820000001, 575.9803880000001, 577.006194, 578.032, 579.057806, 580.083612, 581.109418, 582.135224, 583.16103, 584.186836, 585.2126420000001, 586.2384480000001, 587.264254, 588.29006, 589.315866, 590.341672, 591.367478, 592.393284, 593.41909, 594.444896, 595.4707020000001, 596.4965080000001, 597.522314, 598.54812, 599.573926, 600.599732, 601.625538, 602.651344, 603.67715, 604.702956, 605.7287620000001, 606.7545680000001, 607.780374, 608.80618, 609.831986, 610.857792, 611.883598, 612.909404, 613.93521, 614.961016, 615.9868220000001, 617.0126280000001, 618.038434, 619.06424, 620.090046, 621.115852, 622.141658, 623.167464, 624.19327, 625.219076, 626.2448820000001, 627.2706880000001, 628.296494, 629.3223, 630.348106, 631.373912, 632.399718, 633.425524, 634.45133, 635.477136, 636.5029420000001, 637.5287480000001, 638.554554, 639.58036, 640.606166, 641.631972, 642.657778, 643.683584, 644.70939, 645.735196, 646.7610020000001, 647.7868080000001, 648.812614, 649.83842, 650.864226, 651.890032, 652.915838, 653.941644, 654.96745, 655.993256, 657.0190620000001, 658.0448680000001, 659.070674, 660.09648, 661.122286, 662.148092, 663.173898, 664.199704, 665.22551, 666.251316, 667.2771220000001, 668.3029280000001, 669.328734, 670.35454, 671.380346, 672.406152, 673.431958, 674.457764, 675.48357, 676.509376, 677.5351820000001, 678.5609880000001, 679.586794, 680.6126, 681.638406, 682.664212, 683.690018, 684.715824, 685.74163, 686.767436, 687.7932420000001, 688.8190480000001, 689.844854, 690.87066, 691.896466, 692.922272, 693.948078, 694.973884, 695.99969, 697.025496, 698.0513020000001, 699.0771080000001, 700.102914, 701.12872, 702.154526, 703.180332, 704.206138, 705.231944, 706.25775, 707.283556, 708.3093620000001, 709.3351680000001, 710.360974, 711.38678, 712.412586, 713.438392, 714.464198, 715.490004, 716.51581, 717.541616, 718.5674220000001, 719.5932280000001, 720.619034, 721.64484, 722.670646, 723.696452, 724.722258, 725.748064, 726.77387, 727.799676, 728.8254820000001, 729.8512880000001, 730.877094, 731.9029, 732.928706, 733.954512]
trialInfo = [179.88, 180, -7.703226, 1.025806]

#plt.plot(x, trialSpectrum)
#plt.show()

file = "Spectra/EstimatedBackgroundSpectrum.spe"

def export(file, info, data):
    liveTime, realTime, startValue, stepValue = info
    o = 0
    file = open(file, "w")
    now_str = dt.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    file.write("$SPEC_ID:"
               "\nbMCA Spectrum"
               "\n$DATE_MEA:"
               f"\n{now_str}"
               "\n$MEAS_TIM:"
               f"\n {liveTime:<14g}{realTime:<14g}"
               "\n$DEVICE_ID:"
               "\nbMCA 01223023"
               "\n$ACQ_SETTINGS:"
               "\n 2             120           1000          4             4095 "
               "\n$HRDW_PARAMS:"
               "\nPHA"
               "\n 620"
               "\n 0             0             6 "
               "\n 5             4             2047 "
               "\n 80            25            45 "
               "\n 1             1"
               "\n$SPEC_CAL:"
               f"\n{startValue:<15.6f}{stepValue:<14.6f}{o:<14d}"
               "\n$MCA_CAL:"
               "\n3"
               f"\n{startValue:<15.6f}{stepValue:<14.6f}{o:<14d}"
               "\n$DATA:"
               "\n 0             2047 ")

    while len(data) < 2048:
        data.append(0)

    for i in range(2048//8):
        file.write(f"\n {data[i * 8]:<14d}"
                   f"{data[i * 8 + 1]:<14d}"
                   f"{data[i * 8 + 2]:<14d}"
                   f"{data[i * 8 + 3]:<14d}"
                   f"{data[i * 8 + 4]:<14d}"
                   f"{data[i * 8 + 5]:<14d}"
                   f"{data[i * 8 + 6]:<14d}"
                   f"{data[i * 8 + 7]:<14d}")

    file.close()


export(file, trialInfo, trialSpectrum)